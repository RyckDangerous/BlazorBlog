@page "/articles/create"
@using BlazorBlog.Features.CreateArticle.Services
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]
@inject ICreateArticlePageViewService ViewService

<PageTitle>Cr√©er un article</PageTitle>

<div class="create-article-container">
    <div class="create-article-header">
        <h1 class="tech-title">
            <span class="tech-accent">></span> Cr√©er un nouvel article
        </h1>
        <p class="tech-subtitle">R√©digez votre article en Markdown</p>
    </div>

    <EditForm Model="@ViewService.InputModel" OnValidSubmit="@HandleSubmit" class="article-form">
        <DataAnnotationsValidator />
        
        <div class="form-group">
            <label for="title" class="form-label">
                <span class="label-icon">üìù</span> Titre
            </label>
            <InputText id="title" @bind-Value="ViewService.InputModel.Title" class="form-control tech-input" placeholder="Entrez le titre de votre article..." />
            <ValidationMessage For="@(() => ViewService.InputModel.Title)" class="validation-message" />
        </div>

        <div class="form-group">
            <label for="author" class="form-label">
                <span class="label-icon">üë§</span> Auteur
            </label>
            <InputText id="author" @bind-Value="ViewService.InputModel.Author" class="form-control tech-input" placeholder="Votre nom..." />
            <ValidationMessage For="@(() => ViewService.InputModel.Author)" class="validation-message" />
        </div>

        <div class="form-group">
            <label for="previewText" class="form-label">
                <span class="label-icon">üîç</span> Texte de pr√©visualisation
            </label>
            <InputTextArea id="previewText" @bind-Value="ViewService.InputModel.PreviewText" class="form-control tech-input tech-textarea" 
                          placeholder="Un court texte qui appara√Ætra sur les cartes d'articles..." rows="3" />
            <ValidationMessage For="@(() => ViewService.InputModel.PreviewText)" class="validation-message" />
            <small class="form-hint">Maximum 500 caract√®res</small>
        </div>

        <div class="form-group">
            <label for="content" class="form-label">
                <span class="label-icon">üìÑ</span> Contenu (Markdown)
            </label>
            <InputTextArea id="content" @bind-Value="ViewService.InputModel.Content" class="form-control tech-input tech-textarea tech-content" 
                          placeholder="R√©digez votre article en Markdown ici..." rows="15" />
            <ValidationMessage For="@(() => ViewService.InputModel.Content)" class="validation-message" />
        </div>

        @if (ViewService.ErrorMessage is not null)
        {
            <div class="alert alert-error">
                <span class="alert-icon">‚ö†Ô∏è</span>
                <span>@ViewService.ErrorMessage</span>
            </div>
        }

        @if (ViewService.IsSubmitting)
        {
            <div class="submitting-overlay">
                <div class="spinner"></div>
                <p>Cr√©ation en cours...</p>
            </div>
        }

        <div class="form-actions">
            <button type="submit" class="btn btn-primary tech-btn" disabled="@ViewService.IsSubmitting">
                <span class="btn-icon">üíæ</span>
                @if (ViewService.IsSubmitting)
                {
                    <span>Cr√©ation...</span>
                }
                else
                {
                    <span>Cr√©er l'article</span>
                }
            </button>
            <button type="button" class="btn btn-secondary tech-btn" @onclick="@ViewService.Cancel" disabled="@ViewService.IsSubmitting">
                <span class="btn-icon">‚úñ</span> Annuler
            </button>
        </div>
    </EditForm>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        await ViewService.InitializeAsync();
    }

    private async Task HandleSubmit()
    {
        await ViewService.HandleSubmitAsync();
        StateHasChanged();
    }
}

